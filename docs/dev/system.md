# システム

## アーキテクチャ

### コアモジュール

- `context.ts`: 処理全体の状態管理
- `path-manager.ts`: ファイルパス管理
- `video.ts`: ビデオ処理とオーディオ抽出
- `flashcard.ts`: メインの処理フロー
- `subtitle.ts`: 字幕の読み込みと解析
- `ai.ts`: OpenAI APIを使用した文字起こしと翻訳
- `anki.ts`: Ankiへのフラッシュカード追加
- `cli/index.ts`: CLIインターフェース
- `utils.ts`: ユーティリティ関数

### 処理フロー

1. 初期化
   - コンテキスト（処理全体の状態）を初期化
   - 作業ディレクトリの準備

2. ビデオの読み込み
   - ローカルビデオファイル、またはYouTube URLからビデオをダウンロード
   - ビデオのメタデータ（タイトル、サイズ）を取得
   - 作業ディレクトリに保存

3. オーディオの抽出
   - FFmpegを使用してビデオからオーディオを抽出
   - MP3形式で保存

4. 字幕の処理
   - 既存の字幕ファイルの読み込み、または
   - Whisper APIを使用した文字起こし
   - 翻訳

5. 音声セグメントの抽出
   - FFmpegを使用して字幕のタイミングに合わせて音声を抽出
   - セグメントごとにmp3ファイルを生成

6. Ankiへの出力
   - AnkiConnectを使用してフラッシュカードを追加
   - 音声ファイルの添付
